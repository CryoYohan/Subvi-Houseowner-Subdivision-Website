@model IEnumerable<ELNET1_GROUP_PROJECT.Models.Bill>

@{
    Layout = "_HomeLayout";
    ViewData["Title"] = "Subvi | Bill & Payments";

    string userId = Context.Request.Cookies["Id"];
    string role = Context.Request.Cookies["UserRole"];

    // Declare controller
    string homeController = "";
    string calendarController = "";
    string facilitiesController = "";
    string billController = "";
    string servicesController = "";
    string forumsController = "";
    string feedbacksController = "";
    string resourcesController = "";

    // Default action values
    string homeAction = "";
    string calendarAction = "";
    string facilitiesAction = "";
    string billAction = "";
    string servicesAction = "";
    string forumsAction = "";
    string feedbacksAction = "";
    string resourcesAction = "";

    // Assign controllers/actions based on role
    if (role == "Homeowner")
    {
        homeController = "home"; homeAction = "dashboard";
        calendarController = "home"; calendarAction = "calendar";
        facilitiesController = "home"; facilitiesAction = "facilities";
        billController = "home"; billAction = "bill";
        servicesController = "home"; servicesAction = "services";
        forumsController = "home"; forumsAction = "forums";
        feedbacksController = "home"; feedbacksAction = "feedbacks";
        resourcesController = "home"; resourcesAction = "resources";
    }
}

<div class="flex flex-row overflow-hidden pt-4 flex-shrink-0">
    @* Sidebar *@
    <div class="bg-white rounded-tr-2xl z-50 rounded-br-2xl shadow-md w-56 py-6 h-screen">
        <ul class="space-y-4">
            <li>
                <a class="flex items-center space-x-4 p-3 rounded-l-full sidebar-item hover:bg-gray-100 transition ease-in-out"
                   asp-controller="home" asp-action="dashboard">
                    <i class="fas fa-home text-xl"></i>
                    <span class="font-semibold">Home</span>
                </a>
            </li>
            <li>
                <a class="flex items-center space-x-4 p-3 hover:bg-gray-100 sidebar-item transition ease-in-out rounded-l-full"
                   asp-controller="home" asp-action="calendar">
                    <i class="fas fa-calendar-alt text-xl"></i>
                    <span class="font-semibold">Calendar</span>
                </a>
            </li>
            <li>
                <a class="flex items-center space-x-4 p-3 rounded-l-full sidebar-item hover:bg-gray-100 transition ease-in-out"
                   asp-controller="home" asp-action="facilities">
                    <i class="fas fa-building text-xl"></i>
                    <span class="font-semibold">Facilities</span>
                </a>
            </li>
            <li>
                <a class="flex items-center space-x-4 p-3 rounded-l-full sidebar-item active-item"
                   asp-controller="home" asp-action="bill">
                    <i class="fas fa-file-invoice-dollar text-xl"></i>
                    <span class="font-semibold">Bill Payment</span>
                </a>
            </li>
            <li>
                <a class="flex items-center space-x-4 p-3 rounded-l-full sidebar-item hover:bg-gray-100 transition ease-in-out"
                   asp-controller="home" asp-action="services">
                    <i class="fas fa-tools text-xl"></i>
                    <span class="font-semibold">Services</span>
                </a>
            </li>
            <li>
                <a class="flex items-center space-x-4 p-3 rounded-l-full sidebar-item hover:bg-gray-100 transition ease-in-out"
                   asp-controller="home" asp-action="forums">
                    <i class="fas fa-comments text-xl"></i>
                    <span class="font-semibold">Forums</span>
                </a>
            </li>
            <li>
                <a class="flex items-center space-x-4 p-3 rounded-l-full sidebar-item hover:bg-gray-100 transition ease-in-out"
                   asp-controller="home" asp-action="feedbacks">
                    <i class="fas fa-bullhorn text-xl"></i>
                    <span class="font-semibold">Feedbacks</span>
                </a>
            </li>
            <!-- Resources -->
            <li>
                <a class="flex items-center space-x-4 p-3 rounded-l-full sidebar-item hover:bg-gray-100 transition ease-in-out" asp-controller="@resourcesController" asp-action="@resourcesAction">
                    <i class="fas fa-folder text-xl"></i>
                    <span class="font-semibold">Resources</span>
                </a>
            </li>
        </ul>
    </div>

    @* Bill & Payments UI *@
    <div class="container mt-4">
        <h2 class="text-primary"><i class="fas fa-file-invoice"></i> Bills and Payments</h2>

        <div class="row mt-4">
            <!-- Outstanding Bills -->
            <div class="col-lg-8">
                <div class="card p-4 shadow">
                    <h4 class="text-primary fw-bold">Outstanding Bills</h4>

                    @if (Model.Any())
                    {
                        foreach (var bill in Model)
                        {
                            <div class="card mb-3 p-3 @((bill.Status == "Pending") ? "border-warning" : "border-success")">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        @if (bill.Status == "Pending")
                                        {
                                            <span class="badge bg-warning text-dark">PENDING</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-success">PAID</span>
                                        }
                                        <h5 class="fw-bold mt-2">@bill.BillName</h5>
                                        <p class="mb-1 text-muted">Due: @bill.DueDate</p>
                                        <h3 class="text-success fw-bold">$@bill.BillAmount.ToString("0.00")</h3>
                                    </div>

                                    @if (bill.Status == "Pending")
                                    {
                                        <a href="@Url.Action("PaymentPanel", "Home", new { billId = bill.BillId })" class="btn btn-primary">Pay Now</a>
                                    }
                                    else
                                    {
                                        <a href="@Url.Action("ViewReceipt", "Home", new { billId = bill.BillId })" class="btn btn-outline-primary">View Receipt</a>
                                    }
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <p class="text-center text-muted">No outstanding bills at the moment.</p>
                    }
                </div>
            </div>

            <!-- Payment History & Upcoming Payments -->
            <div class="col-lg-4">
                <div class="card mb-3 p-3 shadow">
                    <h5 class="fw-bold">Payment History</h5>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Reference</th>
                                <th>Date Paid</th>
                                <th>Method</th>
                                <th>Amount</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (ViewBag.PaymentHistory != null)
                            {
                                int count = 1;
                                foreach (var payment in ViewBag.PaymentHistory)
                                {
                                    <tr>
                                        <td>@count</td>
                                        <td>@payment.BillName</td>
                                        <td>@payment.DatePaid</td>
                                        <td><span class="badge bg-info">@payment.PaymentMethod</span></td>
                                        <td class="text-success fw-bold">$@payment.AmountPaid.ToString("0.00")</td>
                                    </tr>
                                    count++;
                                }
                            }
                            else
                            {
                                <tr><td colspan="5" class="text-center text-muted">No payment history yet.</td></tr>
                            }
                        </tbody>
                    </table>
                </div>

                <div class="card p-3 shadow">
                    <h5 class="fw-bold">Upcoming Payment</h5>
                    <p class="text-muted">No upcoming payments.</p>
                </div>
            </div>
        </div>
    </div>
</div>
